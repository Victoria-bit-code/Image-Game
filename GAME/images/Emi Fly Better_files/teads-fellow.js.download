"use strict";!function(){const n={conversionType:"conversion_type",price:"aepp",currency:"aepc",name:"aepn"},t="js-web",e="js-gtm",o="internal",a="bad_integration",i="TEADS_PIXEL_LOADED",c="TEADS_PIXEL_DEBUG",d="TEADS_PIXEL_EVENT",r="TEADS_SDK_PARAMETERS";function s(n){var t;let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};var o;null!==(t=window.opener)&&void 0!==t&&t.postMessage&&window.opener.postMessage({type:n,id:null===(o=window)||void 0===o?void 0:o.name,...e},"*")}function l(){window.opener&&window.addEventListener&&(s(i),window.addEventListener("message",n=>{var t,e,o,a,i;(null==n||null===(t=n.data)||void 0===t?void 0:t.type)===c&&(a=!0,window.teads_debug_mode=a),(null==n||null===(e=n.data)||void 0===e?void 0:e.type)===r&&null!=n&&null!==(o=n.data)&&void 0!==o&&o.teadsClickId&&(P(n.data.teadsClickId),k(),i=n.data.teadsClickId,window.teads_cohort_id=i)}))}function u(n){return"[object Function]"===toString.call(n)}function p(n,t){let e=0;function o(e,o){o?!1!==e.gdprApplies&&"tcloaded"!==e.eventStatus&&"useractioncomplete"!==e.eventStatus||n(e):t("CMP unable to register callback function. Please check CMP setup.")}function a(){return!(!window.$sf||!window.$sf.ext)}function i(n,t){window.$sf.ext.register(1,1,(function(e,o){if("cmpReturn"===e){const e="getConsentData"===n?o.vendorConsentData:o.vendorConsents;t(e)}})),window.$sf.ext.cmp(n)}function c(n){const t="".concat(2===e?"__tcfapi":"__cmp","Return"),o="string"==typeof n.data&&"".concat(n.data).includes(t)?JSON.parse(n.data):n.data;if(o[t]&&o[t].callId){const n=o[t];void 0!==s[n.callId]&&s[n.callId](n.returnValue,n.success)}}function d(n,t,o){const a=2===e?"__tcfapi":"__cmp",i="".concat(a,"Call");2===e?(window[a]=(n,e,o,a)=>{const c="".concat(Math.random()),d={[i]:{command:n,version:e,parameter:a,callId:c}};s[c]=o,t.postMessage(d,"*")},window.addEventListener("message",c,!1),window[a](n,e,o)):(window[a]=(n,e,o)=>{const a="".concat(Math.random()),c={[i]:{command:n,parameter:e,callId:a}};s[a]=o,t.postMessage(c,"*")},window.addEventListener("message",c,!1),window[a](n,void 0,o))}const r=function(){const t={};function e(){t.getConsentData&&t.getVendorConsents&&n(t)}return{consentDataCallback(n){t.getConsentData=n,e()},vendorConsentsCallback(n){t.getVendorConsents=n,e()}}}(),s={},{cmpFrame:l,cmpFunction:p}=function(){let n,t,o=window;for(;!n;){try{if("function"==typeof o.__tcfapi||"function"==typeof o.__cmp){"function"==typeof o.__tcfapi?(e=2,t=o.__tcfapi):(e=1,t=o.__cmp),n=o;break}}catch(n){}try{if(o.frames.__tcfapiLocator){e=2,n=o;break}}catch(n){}try{if(o.frames.__cmpLocator){e=1,n=o;break}}catch(n){}if(o===window.top)break;o=o.parent}return{cmpFrame:n,cmpFunction:t}}();if(!l)return!1;if(new Promise((n,t)=>{u(p)?p("ping",null,()=>n()):1===e&&a()&&"function"==typeof window.$sf.ext.cmp?i("ping",()=>n()):d("ping",l,()=>n()),setTimeout(()=>t(),100)}).catch(()=>t("Unable to ping the CMP")),u(p)){if(1===e)return p("getConsentData",null,r.consentDataCallback),p("getVendorConsents",null,r.vendorConsentsCallback),!0;if(2===e)return p("addEventListener",e,o),!0}else{if(1===e&&a()&&"function"==typeof window.$sf.ext.cmp)return i("getConsentData",r.consentDataCallback),i("getVendorConsents",r.vendorConsentsCallback),!0;if(1===e)return d("getConsentData",l,r.consentDataCallback),d("getVendorConsents",l,r.vendorConsentsCallback),!0;if(2===e)return d("addEventListener",l,o),!0}return!1}function w(n,t){function e(n,t,e){window.__uspapi=(n,e,o)=>{const i="".concat(Math.random()),c={__uspapiCall:{command:n,version:e,callId:i}};a[i]=o,t.postMessage(c,"*")},window.addEventListener("message",(function(n){const t=n&&n.data&&n.data.__uspapiReturn;t&&t.callId&&void 0!==a[t.callId]&&(a[t.callId](t.returnValue,t.success),delete a[t.callId])}),!1),window.__uspapi(n,1,e)}const o=function(){const e={};return{consentDataCallback:(o,a)=>{a&&o.uspString&&(e.usPrivacy=o.uspString),e.usPrivacy?n(e):t("Unable to get USP consent string.")}}}(),a={},{uspapiFrame:i,uspapiFunction:c}=function(){let n,t,e=window;for(;!n;){try{if("function"==typeof e.__uspapi){t=e.__uspapi,n=e;break}}catch(n){}try{if(e.frames.__uspapiLocator){n=e;break}}catch(n){}if(e===window.top)break;e=e.parent}return{uspapiFrame:n,uspapiFunction:t}}();if(!i)return!1;return new Promise((n,t)=>{u(c)?c("getUSPData",null,()=>n()):e("getUSPData",i,()=>n()),setTimeout(()=>t(),100)}).catch(()=>t("Unable to ping the USP")),u(c)?c("getUSPData",1,o.consentDataCallback):e("getUSPData",i,o.consentDataCallback),!0}function v(n){let t="";const e=function(n){let t=n,e=!1;try{for(let n=0;t.parent.document!==t.document||n<50;n+=1){if(!t.parent.document){e=!0;break}t=t.parent}}catch(n){e=!0}return{topFrame:t,err:e}}(n),{topFrame:o}=e;if(e.err)try{t=o.top.location.href}catch(n){t=o.location.href}else t=o.location.href;return t}function f(n,t,e){try{const o={errorMessage:n,topUrl:v(window),userAgent:void 0!==window.navigator&&void 0!==window.navigator.userAgent?window.navigator.userAgent:"",exception:t||"",version:"5.5.2_0335cfe",type:e||a};n=JSON.stringify(o)}catch(n){}document.createElement("img").src="".concat("https://l.teads.tv/performance/http-source","?").concat(encodeURIComponent(n))}function _(n){const t=document.createElement("img");t.width=0,t.height=0,t.alt="",t.style.position="absolute",t.src=n,(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]||document.getElementsByTagName("script")[0].parentNode).insertBefore(t,null),window.teads_debug_mode&&s(d,{trackingUrl:n,ts:Date.now()})}function m(n){fetch?fetch(n).catch(()=>{_(n)}):_(n)}function g(n){try{const t=new RegExp(/(?:\?|&|%3F|%26)auctid(?:=|%3D)([0-9a-zA-Z-_]*)/).exec(n);if(t&&t.length>=2)return t[1]}catch(n){f("Error when extracting Auction ID from url",null==n?void 0:n.message,o)}}async function y(n,a,i){var c,d;const r=V(),s=M(),l=function(){if(!window.teads_env||![t,e].includes(window.teads_env))return t;return window.teads_env}(),u=function(n){const t=[];return Object.keys(n).forEach(e=>{t.push("".concat(e,"=").concat(encodeURIComponent(n[e])))}),t.join("&")}(a),p=v(window),w=function(n){let t=U();if(!t){let e=n;n||(e=v(window)),t=g(e),t&&P(t)}return t}(p),_=S(),m=R(),y=window.teads_gdpr_advertiser,h=window.teads_ccpa_advertiser,C=window.teads_cohort_id,b=await async function(){let n=null;try{if("browsingTopics"in document&&null!==(t=document)&&void 0!==t&&null!==(e=t.featurePolicy)&&void 0!==e&&null!==(a=e.allowedFeatures)&&void 0!==a&&null!==(i=a.call(e))&&void 0!==i&&null!==(c=i.includes)&&void 0!==c&&c.call(i,"browsing-topics")){const t=await document.browsingTopics();t&&(n=btoa(JSON.stringify(t)))}}catch(n){f("Error when retrieving topics from Topics API",null==n?void 0:n.message,o)}var t,e,a,i,c;return n}(),k=function(n){const t=["account","password","pass","secret","secretkey","username","user","login","ordernumber","orderid","email","mail","user.email","user.password","user.name","user.mail","user.lastname","user.firstname","user.phone","user.phonenumber","lastname","firstname","name","address","phonenumber","phone","client_secret","guid"];if(""!==n){const e=n.split("?").length>1?n.split("?")[1]:void 0;if(void 0!==e){let o="".concat(n.split("?")[0],"?");const a=e.split("&");for(let n=0;n<a.length;n+=1){const e=a[n].split(/=(.+)/);o="".concat(o+(0===n?"":"&")+e[0],"=").concat(t.indexOf(e[0])>=0?"XXXXXXXX":e[1])}n=o}}return n}(p);let I="".concat(i,"?action=").concat(n,"&env=").concat(encodeURIComponent(l),"&tag_version=").concat(encodeURIComponent("5.5.2_0335cfe"));return u.length>0&&(I="".concat(I,"&").concat(u)),void 0!==s?I="".concat(I,"&buyer_pixel_id=").concat(encodeURIComponent(s)):void 0!==r&&(I="".concat(I,"&advertiser_id=").concat(encodeURIComponent(r))),I="".concat(I,"&referer=").concat(encodeURIComponent(k)),void 0!==w&&(I="".concat(I,"&auctid=").concat(w)),void 0!==C&&(I="".concat(I,"&cohort_id=").concat(C)),b&&(I="".concat(I,"&browser_topics=").concat(b)),void 0!==(null==_||null===(c=_.data)||void 0===c?void 0:c.tcString)&&(I="".concat(I,"&gdpr_consent=").concat(_.data.tcString)),null!=y&&y.apply?I="".concat(I,"&gdpr_status=12"):void 0!==(null==y?void 0:y.apply)&&(I="".concat(I,"&gdpr_status=0")),y&&(void 0!==y.apply&&(I="".concat(I,"&gdpr_apply=").concat(y.apply)),void 0!==y.teadsConsent&&(I="".concat(I,"&gtc=").concat(y.teadsConsent)),void 0!==y.isServiceSpecific&&(I="".concat(I,"&gdpr_is_service_specific=").concat(y.isServiceSpecific)),void 0!==y.cmpId&&(I="".concat(I,"&gdpr_cmp_id=").concat(y.cmpId)),void 0!==y.apiVersion&&(I="".concat(I,"&gdpr_api_version=").concat(y.apiVersion))),void 0!==(null==m||null===(d=m.data)||void 0===d?void 0:d.usPrivacy)&&(I="".concat(I,"&ccpa_consent=").concat(m.data.usPrivacy)),h&&(void 0!==h.apply&&(I="".concat(I,"&ca=").concat(h.apply)),void 0!==h.teadsConsent&&(I="".concat(I,"&ctc=").concat(h.teadsConsent))),I}async function h(){if(void 0!==window.teads_e){const n=[];for(;window.teads_e.length;)n.push(X(window.teads_e.shift()));await Promise.all(n)}else f("The event queue is not defined.")}function C(n){try{const t="".concat(n,"="),e=document.cookie.split(";");for(let n=0;n<e.length;n+=1)if(e[n]=e[n].trim(),0===e[n].indexOf(t))return e[n].substring(t.length,e[n].length)}catch(t){f('Error while reading first-party cookie with key "'.concat(n,'"'),null==t?void 0:t.message,o)}return""}function b(n,t){let e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,c="".concat(n,"=").concat(t);a&&(c+=";path=".concat(a)),"number"==typeof o&&(c+=";max-age=".concat(o)),e&&(c+=";domain=.".concat(e)),i&&(c+=";samesite=".concat(i)),document.cookie=c}function k(){T()&&U()&&function(n,t,e){try{b(n,t,e,2592e3,"/","strict")}catch(t){f('Error while setting cookie on domain with key "'.concat(n,'"'),null==t?void 0:t.message,o)}}("tfpai",U(),window.advertiser_domain)}async function I(){var n;const t=V(),e=M(),a=v(window);let i="referer=".concat(encodeURIComponent(a));void 0!==e?i+="&buyer_pixel_id=".concat(encodeURIComponent(e)):void 0!==t&&(i+="&advertiser_id=".concat(encodeURIComponent(t)));const c=S();var d,r,s,l,u,p;c&&(void 0!==(null==c||null===(d=c.data)||void 0===d?void 0:d.gdprApplies)?i+="&gdpr_applies=".concat(encodeURIComponent(c.data.gdprApplies)):void 0!==(null==c||null===(r=c.data)||void 0===r||null===(s=r.getConsentData)||void 0===s?void 0:s.gdprApplies)&&(i+="&gdpr_applies=".concat(encodeURIComponent(c.data.getConsentData.gdprApplies))),null!=c&&null!==(l=c.data)&&void 0!==l&&l.tcString?i+="&gdpr_consent=".concat(encodeURIComponent(c.data.tcString)):null!=c&&null!==(u=c.data)&&void 0!==u&&null!==(p=u.getConsentData)&&void 0!==p&&p.consentData&&(i+="&gdpr_consent=".concat(encodeURIComponent(c.data.getConsentData.consentData))),null!=c&&c.error&&(i+="&gdpr_error=".concat(encodeURIComponent(c.error))));const w=R();null!=w&&null!==(n=w.data)&&void 0!==n&&n.usPrivacy&&(i+="&ccpa_consent=".concat(encodeURIComponent(w.data.usPrivacy))),null!=w&&w.error&&(i+="&ccpa_error=".concat(encodeURIComponent(w.error)));const _=function(){const n=C("optout");if(n)return"1"===n;return}();void 0!==_&&(i+="&web_opt_out=".concat(encodeURIComponent(_)));try{const n=await fetch("".concat("https://cm.teads.tv","/v2/advertiser?").concat(i));if(200===(null==n?void 0:n.status)){var m,y,h,b,k,I;const t=await n.json();return{trackingAllowed:!1!==(null==t?void 0:t.tracking_allowed),firstPartyCookieAllowed:!0===(null==t?void 0:t.first_party_cookie_allowed),auctionId:null==t?void 0:t.auction_id,domain:null==t?void 0:t.domain,ccpa:null!=t&&t.ccpa?{apply:null===(m=t.ccpa)||void 0===m?void 0:m.apply,teadsConsent:null===(y=t.ccpa)||void 0===y?void 0:y.teads_consent}:void 0,gdpr:null!=t&&t.gdpr?{apply:null===(h=t.gdpr)||void 0===h?void 0:h.apply,teadsConsent:null===(b=t.gdpr)||void 0===b?void 0:b.teads_consent,apiVersion:null===(k=t.gdpr)||void 0===k?void 0:k.api_version,cmpId:null===(I=t.gdpr)||void 0===I?void 0:I.cmp_id,isServiceSpecific:null==t?void 0:t.gdpr.is_service_specific}:void 0}}}catch(n){f("Error while trigger API to know advertiser information",null==n?void 0:n.message,o)}const E=g(a);return E?{trackingAllowed:!0,firstPartyCookieAllowed:!1,auctionId:E}:{trackingAllowed:!0,firstPartyCookieAllowed:!1}}async function E(n,t){try{if(null!==(e=document)&&void 0!==e&&null!==(a=e.featurePolicy)&&void 0!==a&&null!==(i=a.allowedFeatures)&&void 0!==i&&null!==(c=i.call(a))&&void 0!==c&&null!==(d=c.includes)&&void 0!==d&&d.call(c,"attribution-reporting")){_(await y(n,t,"".concat("https://cm.teads.tv","/v3/conversion")))}}catch(n){f("Error when triggering attribution reporting conversion",null==n?void 0:n.message,o)}var e,a,i,c,d}function P(n){window.teads_auction_id=n}function U(){return window.teads_auction_id}function A(n){window.teads_iab_consent_data=n}function S(){return window.teads_iab_consent_data}function D(n){window.teads_usp_consent_data=n}function R(){return window.teads_usp_consent_data}function x(){return!0===window.teads_tracking_allowed}function T(){return!0!==window.teads_disable_first_party_cookie&&window.first_party_cookie_allowed}async function L(){try{const{auctionId:i,gdpr:c,ccpa:d,firstPartyCookieAllowed:r,domain:s,trackingAllowed:l}=await I();if(a=r,window.first_party_cookie_allowed=a,l&&(e=l,window.teads_tracking_allowed=e),c&&(t=c,window.teads_gdpr_advertiser=t),d&&function(n){window.teads_ccpa_advertiser=n}(d),s&&(n=s,window.advertiser_domain=n),i&&P(i),T()){const n=C("tfpai");!U()&&n&&P(n),k()}else!function(n,t){try{b(n,"",t,0,"/","strict")}catch(t){f('Error while deleting cookie on domain with key "'.concat(n,'"'),null==t?void 0:t.message,o)}}("tfpai",s)}catch(n){f("Error while initializing advertiser",null==n?void 0:n.message,o)}var n,t,e,a}async function O(){const n=V(),t=M();"number"!=typeof n&&"number"!=typeof t||(await L(),await async function(){if(!x())return;_(await y("pageView",{},"https://t.teads.tv/track")),await E("pageView",{});let n=!1;const t=await y("timeSpent",{},"https://t.teads.tv/track");document.addEventListener("visibilitychange",()=>{"hidden"!==document.visibilityState||n||(n=!0,function(n){const t=navigator.sendBeacon&&navigator.sendBeacon.bind(navigator);try{t&&t(n)||m(n)}catch(t){m(n)}}(t))})}())}async function F(){j();try{window.teads_adv_id||Object.defineProperty(window,"teads_adv_id",{set(n){this._teads_adv_id=n,O()},get(){return this._teads_adv_id},configurable:!0}),window.teads_buyer_pixel_id||Object.defineProperty(window,"teads_buyer_pixel_id",{set(n){this._teads_buyer_pixel_id=n,O()},get(){return this._teads_buyer_pixel_id},configurable:!0})}catch(n){f("Error while binding advertiser and pixel ids",null==n?void 0:n.message)}await O();const n=window.teads_e||[];window.teads_e=[],window.teads_e.push=function(){for(var n=arguments.length,t=new Array(n),e=0;e<n;e++)t[e]=arguments[e];return Array.prototype.push.apply(this,t),h(),window.teads_e.length},window.teads_e.push(...n)}function V(){if(void 0!==window.teads&&void 0!==window.teads.advertiserId){if("number"==typeof window.teads.advertiserId)return window.teads.advertiserId;f("The format of AdvertiserId is not valid.")}else{if(void 0===window.teads_cv||void 0===window.teads_cv.advertiserId)return window.teads_adv_id;if("number"==typeof window.teads_cv.advertiserId)return window.teads_cv.advertiserId;f("The format of AdvertiserId is not valid.")}}function M(){return window.teads_buyer_pixel_id}async function X(t){if(!x())return;const e=function(t,e){const o={};return Object.keys(t).forEach(a=>{const i=a,c=t[a];Object.prototype.hasOwnProperty.call(n,i)?o[n[i]]=c+(e||""):f("Invalid parameter specified in event: ".concat(i))}),o}(t);_(await y("conversion",e,"https://t.teads.tv/track")),await E("conversion",e)}function j(){const n=document.createElement("meta");n.httpEquiv="origin-trial",n.content="A3TnmCYheX1/A4Pqu0Qib4yXjIqWQEcdA9GJee7RDIRUV6VG/zUXn3vw6IG7OlNLrMIdHBLFsS3nd5GHYuSnSwUAAAB+eyJvcmlnaW4iOiJodHRwczovL3RlYWRzLnR2OjQ0MyIsImZlYXR1cmUiOiJQcml2YWN5U2FuZGJveEFkc0FQSXMiLCJleHBpcnkiOjE2NjEyOTkxOTksImlzU3ViZG9tYWluIjp0cnVlLCJpc1RoaXJkUGFydHkiOnRydWV9",document.head.appendChild(n)}function J(n,t){return new Promise(e=>{n(n=>{t({data:n}),e()},n=>{t({error:n}),e()})||e()})}async function N(n){try{"undefined"!=typeof window&&await new Promise((t,e)=>{setTimeout(()=>{l(),Promise.all([J(p,A),J(w,D)]).then(()=>F()).then(t).catch(e)},n>0?n:0)})}catch(n){f("Unhandled exception",null==n?void 0:n.message,o)}}N(0),"undefined"!=typeof module&&void 0!==module.exports&&(module.exports.tag=N,module.exports.getTopUrl=v,module.exports.setPrivacySandboxRelevanceAndMeasurementTrialToken=j)}();